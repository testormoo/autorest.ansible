sudo: required

services:
  - docker

script:
  - cd dockerfile-inc && docker build --tag dockiot/autorest-ansible-inc .
  - git config --global user.email "zikalino@microsoft.com"
  - git config --global user.name "zikalino"
  - cd ~ ; git clone https://github.com/zikalino/ansible-hatchery.git
  - cd ~/ansible-hatchery ; git config credential.helper store
  - echo "https://zikalino:${GH_TOKEN}@github.com" > ~/.git-credentials

  - cd ~ ; mkdir tmp
  - cd ~/ansible-hatchery ; git checkout autogenerated || git checkout -B autogenerated
  - docker run --name autorest-ansible -v ~/ansible-hatchery:/ansible-hatchery -v ~/tmp:/ansible-hatchery-tmp dockiot/autorest-ansible-inc all
  - cd ~/ansible-hatchery ; git diff ; git add -A ; git commit -m "autogenerated" ; git push --set-upstream origin autogenerated

after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ]; then
    docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD";
    docker push dockiot/autorest-ansible-inc;
    fi

