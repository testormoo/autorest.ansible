sudo: required

services:
  - docker

script:
  - cd dockerfile-inc && docker build --tag dockiot/autorest-ansible-inc .
  - git clone https://github.com/zikalino/ansible-hatchery.git
  - cd ~ && mkdir tmp && git clone https://github.com/zikalino/ansible-hatchery.git
  - cd ~/ansible-hatchery && git branch -b autogenerated
  - docker run --name autorest-ansible -v ~/ansible-hatchery:/ansible-hatchery -v ~/tmp:/ansible-hatchery-tmp dockiot/autorest-ansible-inc all
  - cd ~/ansible-hatchery && git diff && git add -A && git commit -m "autogenerated" && git push

after_success:
  - if [ "$TRAVIS_BRANCH" == "master" ]; then
    docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD";
    docker push dockiot/autorest-ansible-inc;
    fi

